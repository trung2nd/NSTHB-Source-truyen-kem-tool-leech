<?php

function chuyenurl($string){
	$string = bodau($string);
	$string = str_replace(" ", "-", $string);
	return $string;
}

function kiemtra($test)
{
	$a = mysql_real_escape_string($test);
	return $a;
}
function trimkhoangtrang($text)
{
	$text = preg_replace('/\s\s+/', ' ', trim($text));
	return $text;
}



function xoatag($txt,$tags){
   
    preg_match_all("/<([^>]+)>/i",$tags,$allTags,PREG_PATTERN_ORDER);

    foreach ($allTags[1] as $tag){
        $txt = preg_replace("/<".$tag."[^>]*>/i","<".$tag.">",$txt);
    }

    return $txt;
}

function encode($string,$key="789456") {
    $key = sha1($key);
    $strLen = strlen($string);
    $keyLen = strlen($key);
    for ($i = 0; $i < $strLen; $i++) {
        $ordStr = ord(substr($string,$i,1));
        if ($j == $keyLen) { $j = 0; }
        $ordKey = ord(substr($key,$j,1));
        $j++;
        $hash .= strrev(base_convert(dechex($ordStr + $ordKey),16,36));
    }
    return $hash;
}

function decode($string,$key="789456") {
    $key = sha1($key);
    $strLen = strlen($string);
    $keyLen = strlen($key);
    for ($i = 0; $i < $strLen; $i+=2) {
        $ordStr = hexdec(base_convert(strrev(substr($string,$i,2)),36,16));
        if ($j == $keyLen) { $j = 0; }
        $ordKey = ord(substr($key,$j,1));
        $j++;
        $hash .= chr($ordStr - $ordKey);
    }
    return $hash;
}


function getimg($noidung)
{
//Đóng dấu bài viết
$contents = $noidung;
$pattern = '/src=[\"\']?([^\"\']?.*(png|jpg|gif))[\"\']?/i';
preg_match_all($pattern, $contents, $images);
$imageCount = count($images[1]);
//include('class_resize_img.php');
//include('watermark.php');
for ($i=0; $i<$imageCount; $i++){
    $tenhinh = "";
    $time = "";
    
    $file_url = $images[1][$i];
    $check = explode("/",$file_url);
    if($check[2] != "ctvispace.tk")
    {
        $temp = explode("/",$file_url);
        $dem = count($temp);
        $so = $dem - 1;
        $tenhinh = $temp[$so];
        $time = time();
       
        $path = "hinhanhleech/";
        $filehinh = file_get_contents($file_url);
        $tenhinh = $time.$tenhinh;
        file_put_contents($path.$tenhinh, $filehinh);
        
        //resize
        /*
        $image = new SimpleImage();
        $image->load($path.$tenhinh);
        $rong = $image->getWidth();
        $cao = $image->getHeight();
        if($rong > 600)
        {
            $image->resizeToWidth(600);
        }
        $image->save($path.$tenhinh);
        
        //dong dau hinh
        if($rong > 350)
		{
			$sourceFile = $path.$tenhinh;
			$watermarkFile = "watermark/logo.png";
			$run = createWatermark($sourceFile, $watermarkFile, $marginLeft = 5, $marginBottom = 5, $quality = 100, $transparency = 100);
		}
		*/
		
        //thay the
        $noidung = str_replace($file_url,"http://localhost/leech/".$path.$tenhinh,$noidung);
    }
    }
    return $noidung;
}


function chuyenngay($ngay)
{
$tmp = explode(" ",$ngay);

$tmp = explode("-",$tmp[0]);
$ketqua = "$tmp[2]-$tmp[1]-$tmp[0]";
return $ketqua;
}

function chuyenngay2($ngay)
{
$tmp = explode("-",$ngay);
$ketqua = "$tmp[2]-$tmp[1]-$tmp[0]";
return $ketqua;
}


function chuyenngaygio($ngay)
{
$ngay = date_create($ngay);
$ngay = date_format($ngay, 'd-m-Y H:i:s');
return $ngay;
}


function so($nu)
{
$ketqua = number_format($nu,0,"",".");
return $ketqua;
}

//Ma hoa chuoi thanh NCR
function mahoa($str) {

if ( get_magic_quotes_gpc() )
	$str = htmlspecialchars( stripslashes( $str ) ) ;
	//$str = htmlentities($str, ENT_QUOTES);
else
	$str = htmlspecialchars( $str );
	//$str = htmlentities($str, ENT_QUOTES);

$convmap = array(
 0xe1,0xe1,0x0,0xe1,0xc1,0xc1,0x0,0xc1,0xe0,0xe0,0x0,0xe0,
			0xc0,0xc0,0x0,0xc0,0x1ea3,0x1ea3,0x0,0x1ea3,0x1ea2,0x1ea2,0x0,0x1ea2,
			0xe3,0xe3,0x0,0xe3,0xc3,0xc3,0x0,0xc3,0x1ea1,0x1ea1,0x0,0x1ea1,
			0x1ea0,0x1ea0,0x0,0x1ea0,0x103,0x103,0x0,0x103,0x102,0x102,0x0,0x102,
			0x1eaf,0x1eaf,0x0,0x1eaf,0x1eae,0x1eae,0x0,0x1eae,0x1eb1,0x1eb1,0x0,0x1eb1,
			0x1eb0,0x1eb0,0x0,0x1eb0,0x1eb3,0x1eb3,0x0,0x1eb3,0x1eb2,0x1eb2,0x0,0x1eb2,
			0x1eb5,0x1eb5,0x0,0x1eb5,0x1eb4,0x1eb4,0x0,0x1eb4,0x1eb7,0x1eb7,0x0,0x1eb7,
			0x1eb6,0x1eb6,0x0,0x1eb6,0xe2,0xe2,0x0,0xe2,0xc2,0xc2,0x0,0xc2,
			0x1ea5,0x1ea5,0x0,0x1ea5,0x1ea4,0x1ea4,0x0,0x1ea4,0x1ea7,0x1ea7,0x0,0x1ea7,
			0x1ea6,0x1ea6,0x0,0x1ea6,0x1ea9,0x1ea9,0x0,0x1ea9,0x1ea8,0x1ea8,0x0,0x1ea8,
			0x1eab,0x1eab,0x0,0x1eab,0x1eaa,0x1eaa,0x0,0x1eaa,0x1ead,0x1ead,0x0,0x1ead,
			0x1eac,0x1eac,0x0,0x1eac,0xe9,0xe9,0x0,0xe9,0xc9,0xc9,0x0,0xc9,
			0xe8,0xe8,0x0,0xe8,0xc8,0xc8,0x0,0xc8,0x1ebb,0x1ebb,0x0,0x1ebb,
			0x1eba,0x1eba,0x0,0x1eba,0x1ebd,0x1ebd,0x0,0x1ebd,0x1ebc,0x1ebc,0x0,0x1ebc,
			0x1eb9,0x1eb9,0x0,0x1eb9,0x1eb8,0x1eb8,0x0,0x1eb8,0xea,0xea,0x0,0xea,
			0xca,0xca,0x0,0xca,0x1ebf,0x1ebf,0x0,0x1ebf,0x1ebe,0x1ebe,0x0,0x1ebe,
			0x1ec1,0x1ec1,0x0,0x1ec1,0x1ec0,0x1ec0,0x0,0x1ec0,0x1ec3,0x1ec3,0x0,0x1ec3,
			0x1ec2,0x1ec2,0x0,0x1ec2,0x1ec5,0x1ec5,0x0,0x1ec5,0x1ec4,0x1ec4,0x0,0x1ec4,
			0x1ec7,0x1ec7,0x0,0x1ec7,0x1ec6,0x1ec6,0x0,0x1ec6,0xed,0xed,0x0,0xed,
			0xcd,0xcd,0x0,0xcd,0xec,0xec,0x0,0xec,0xcc,0xcc,0x0,0xcc,
			0x1ec9,0x1ec9,0x0,0x1ec9,0x1ec8,0x1ec8,0x0,0x1ec8,0x128,0x128,0x0,0x128,
			0x129,0x129,0x0,0x129,0x1ecb,0x1ecb,0x0,0x1ecb,0x1eca,0x1eca,0x0,0x1eca,
			0xf3,0xf3,0x0,0xf3,0xd3,0xd3,0x0,0xd3,0xf2,0xf2,0x0,0xf2,
			0xd2,0xd2,0x0,0xd2,0x1ecf,0x1ecf,0x0,0x1ecf,0x1ece,0x1ece,0x0,0x1ece,
			0xf5,0xf5,0x0,0xf5,0xd5,0xd5,0x0,0xd5,0x1ecd,0x1ecd,0x0,0x1ecd,
			0x1ecc,0x1ecc,0x0,0x1ecc,0x1a1,0x1a1,0x0,0x1a1,0x1a0,0x1a0,0x0,0x1a0,
			0x1edb,0x1edb,0x0,0x1edb,0x1eda,0x1eda,0x0,0x1eda,0x1edd,0x1edd,0x0,0x1edd,
			0x1edc,0x1edc,0x0,0x1edc,0x1edf,0x1edf,0x0,0x1edf,0x1ede,0x1ede,0x0,0x1ede,
			0x1ee1,0x1ee1,0x0,0x1ee1,0x1ee0,0x1ee0,0x0,0x1ee0,0x1ee3,0x1ee3,0x0,0x1ee3,
			0x1ee2,0x1ee2,0x0,0x1ee2,0xf4,0xf4,0x0,0xf4,0xd4,0xd4,0x0,0xd4,
			0x1ed1,0x1ed1,0x0,0x1ed1,0x1ed0,0x1ed0,0x0,0x1ed0,0x1ed3,0x1ed3,0x0,0x1ed3,
			0x1ed2,0x1ed2,0x0,0x1ed2,0x1ed5,0x1ed5,0x0,0x1ed5,0x1ed4,0x1ed4,0x0,0x1ed4,
			0x1ed7,0x1ed7,0x0,0x1ed7,0x1ed6,0x1ed6,0x0,0x1ed6,0x1ed9,0x1ed9,0x0,0x1ed9,
			0x1ed8,0x1ed8,0x0,0x1ed8,0xfa,0xfa,0x0,0xfa,0xda,0xda,0x0,0xda,
			0xf9,0xf9,0x0,0xf9,0xd9,0xd9,0x0,0xd9,0x1ee7,0x1ee7,0x0,0x1ee7,
			0x1ee6,0x1ee6,0x0,0x1ee6,0x169,0x169,0x0,0x169,0x168,0x168,0x0,0x168,
			0x1ee5,0x1ee5,0x0,0x1ee5,0x1ee4,0x1ee4,0x0,0x1ee4,0x1b0,0x1b0,0x0,0x1b0,
			0x1af,0x1af,0x0,0x1af,0x1ee9,0x1ee9,0x0,0x1ee9,0x1ee8,0x1ee8,0x0,0x1ee8,
			0x1eeb,0x1eeb,0x0,0x1eeb,0x1eea,0x1eea,0x0,0x1eea,0x1eed,0x1eed,0x0,0x1eed,
			0x1eec,0x1eec,0x0,0x1eec,0x1eef,0x1eef,0x0,0x1eef,0x1eee,0x1eee,0x0,0x1eee,
			0x1ef1,0x1ef1,0x0,0x1ef1,0x1ef0,0x1ef0,0x0,0x1ef0,0xfd,0xfd,0x0,0xfd,
			0xdd,0xdd,0x0,0xdd,0x1ef3,0x1ef3,0x0,0x1ef3,0x1ef2,0x1ef2,0x0,0x1ef2,
			0x1ef7,0x1ef7,0x0,0x1ef7,0x1ef6,0x1ef6,0x0,0x1ef6,0x1ef9,0x1ef9,0x0,0x1ef9,
			0x1ef8,0x1ef8,0x0,0x1ef8,0x1ef5,0x1ef5,0x0,0x1ef5,0x1ef4,0x1ef4,0x0,0x1ef4,
			0x111,0x111,0x0,0x111,0x110,0x110,0x0,0x110,
  );

 return mb_encode_numericentity($str, $convmap, "UTF-8");
}

//Giải mã chuỗi
function giaima($str){
	$s = htmlspecialchars_decode($str);
	return $s;
}

function chuyenquaunicode($str) {

$convmap = array(
  0xe1,0xe1,0x0,0xe1,0xc1,0xc1,0x0,0xc1,0xe0,0xe0,0x0,0xe0,
			0xc0,0xc0,0x0,0xc0,0x1ea3,0x1ea3,0x0,0x1ea3,0x1ea2,0x1ea2,0x0,0x1ea2,
			0xe3,0xe3,0x0,0xe3,0xc3,0xc3,0x0,0xc3,0x1ea1,0x1ea1,0x0,0x1ea1,
			0x1ea0,0x1ea0,0x0,0x1ea0,0x103,0x103,0x0,0x103,0x102,0x102,0x0,0x102,
			0x1eaf,0x1eaf,0x0,0x1eaf,0x1eae,0x1eae,0x0,0x1eae,0x1eb1,0x1eb1,0x0,0x1eb1,
			0x1eb0,0x1eb0,0x0,0x1eb0,0x1eb3,0x1eb3,0x0,0x1eb3,0x1eb2,0x1eb2,0x0,0x1eb2,
			0x1eb5,0x1eb5,0x0,0x1eb5,0x1eb4,0x1eb4,0x0,0x1eb4,0x1eb7,0x1eb7,0x0,0x1eb7,
			0x1eb6,0x1eb6,0x0,0x1eb6,0xe2,0xe2,0x0,0xe2,0xc2,0xc2,0x0,0xc2,
			0x1ea5,0x1ea5,0x0,0x1ea5,0x1ea4,0x1ea4,0x0,0x1ea4,0x1ea7,0x1ea7,0x0,0x1ea7,
			0x1ea6,0x1ea6,0x0,0x1ea6,0x1ea9,0x1ea9,0x0,0x1ea9,0x1ea8,0x1ea8,0x0,0x1ea8,
			0x1eab,0x1eab,0x0,0x1eab,0x1eaa,0x1eaa,0x0,0x1eaa,0x1ead,0x1ead,0x0,0x1ead,
			0x1eac,0x1eac,0x0,0x1eac,0xe9,0xe9,0x0,0xe9,0xc9,0xc9,0x0,0xc9,
			0xe8,0xe8,0x0,0xe8,0xc8,0xc8,0x0,0xc8,0x1ebb,0x1ebb,0x0,0x1ebb,
			0x1eba,0x1eba,0x0,0x1eba,0x1ebd,0x1ebd,0x0,0x1ebd,0x1ebc,0x1ebc,0x0,0x1ebc,
			0x1eb9,0x1eb9,0x0,0x1eb9,0x1eb8,0x1eb8,0x0,0x1eb8,0xea,0xea,0x0,0xea,
			0xca,0xca,0x0,0xca,0x1ebf,0x1ebf,0x0,0x1ebf,0x1ebe,0x1ebe,0x0,0x1ebe,
			0x1ec1,0x1ec1,0x0,0x1ec1,0x1ec0,0x1ec0,0x0,0x1ec0,0x1ec3,0x1ec3,0x0,0x1ec3,
			0x1ec2,0x1ec2,0x0,0x1ec2,0x1ec5,0x1ec5,0x0,0x1ec5,0x1ec4,0x1ec4,0x0,0x1ec4,
			0x1ec7,0x1ec7,0x0,0x1ec7,0x1ec6,0x1ec6,0x0,0x1ec6,0xed,0xed,0x0,0xed,
			0xcd,0xcd,0x0,0xcd,0xec,0xec,0x0,0xec,0xcc,0xcc,0x0,0xcc,
			0x1ec9,0x1ec9,0x0,0x1ec9,0x1ec8,0x1ec8,0x0,0x1ec8,0x128,0x128,0x0,0x128,
			0x129,0x129,0x0,0x129,0x1ecb,0x1ecb,0x0,0x1ecb,0x1eca,0x1eca,0x0,0x1eca,
			0xf3,0xf3,0x0,0xf3,0xd3,0xd3,0x0,0xd3,0xf2,0xf2,0x0,0xf2,
			0xd2,0xd2,0x0,0xd2,0x1ecf,0x1ecf,0x0,0x1ecf,0x1ece,0x1ece,0x0,0x1ece,
			0xf5,0xf5,0x0,0xf5,0xd5,0xd5,0x0,0xd5,0x1ecd,0x1ecd,0x0,0x1ecd,
			0x1ecc,0x1ecc,0x0,0x1ecc,0x1a1,0x1a1,0x0,0x1a1,0x1a0,0x1a0,0x0,0x1a0,
			0x1edb,0x1edb,0x0,0x1edb,0x1eda,0x1eda,0x0,0x1eda,0x1edd,0x1edd,0x0,0x1edd,
			0x1edc,0x1edc,0x0,0x1edc,0x1edf,0x1edf,0x0,0x1edf,0x1ede,0x1ede,0x0,0x1ede,
			0x1ee1,0x1ee1,0x0,0x1ee1,0x1ee0,0x1ee0,0x0,0x1ee0,0x1ee3,0x1ee3,0x0,0x1ee3,
			0x1ee2,0x1ee2,0x0,0x1ee2,0xf4,0xf4,0x0,0xf4,0xd4,0xd4,0x0,0xd4,
			0x1ed1,0x1ed1,0x0,0x1ed1,0x1ed0,0x1ed0,0x0,0x1ed0,0x1ed3,0x1ed3,0x0,0x1ed3,
			0x1ed2,0x1ed2,0x0,0x1ed2,0x1ed5,0x1ed5,0x0,0x1ed5,0x1ed4,0x1ed4,0x0,0x1ed4,
			0x1ed7,0x1ed7,0x0,0x1ed7,0x1ed6,0x1ed6,0x0,0x1ed6,0x1ed9,0x1ed9,0x0,0x1ed9,
			0x1ed8,0x1ed8,0x0,0x1ed8,0xfa,0xfa,0x0,0xfa,0xda,0xda,0x0,0xda,
			0xf9,0xf9,0x0,0xf9,0xd9,0xd9,0x0,0xd9,0x1ee7,0x1ee7,0x0,0x1ee7,
			0x1ee6,0x1ee6,0x0,0x1ee6,0x169,0x169,0x0,0x169,0x168,0x168,0x0,0x168,
			0x1ee5,0x1ee5,0x0,0x1ee5,0x1ee4,0x1ee4,0x0,0x1ee4,0x1b0,0x1b0,0x0,0x1b0,
			0x1af,0x1af,0x0,0x1af,0x1ee9,0x1ee9,0x0,0x1ee9,0x1ee8,0x1ee8,0x0,0x1ee8,
			0x1eeb,0x1eeb,0x0,0x1eeb,0x1eea,0x1eea,0x0,0x1eea,0x1eed,0x1eed,0x0,0x1eed,
			0x1eec,0x1eec,0x0,0x1eec,0x1eef,0x1eef,0x0,0x1eef,0x1eee,0x1eee,0x0,0x1eee,
			0x1ef1,0x1ef1,0x0,0x1ef1,0x1ef0,0x1ef0,0x0,0x1ef0,0xfd,0xfd,0x0,0xfd,
			0xdd,0xdd,0x0,0xdd,0x1ef3,0x1ef3,0x0,0x1ef3,0x1ef2,0x1ef2,0x0,0x1ef2,
			0x1ef7,0x1ef7,0x0,0x1ef7,0x1ef6,0x1ef6,0x0,0x1ef6,0x1ef9,0x1ef9,0x0,0x1ef9,
			0x1ef8,0x1ef8,0x0,0x1ef8,0x1ef5,0x1ef5,0x0,0x1ef5,0x1ef4,0x1ef4,0x0,0x1ef4,
			0x111,0x111,0x0,0x111,0x110,0x110,0x0,0x110,
  );

 return mb_decode_numericentity($str, $convmap, "UTF-8");
}
//Cat chuoi dai
function catchuoi($string = "", $num = 20){	
	    if(strlen($string) > $num)
	    {
	    	$result = substr($string,0,$num); //cut string with limited number
	    	$position = strrpos($result," "); //find position of last space
	    	if($position)
	    		$result = substr($result,0,$position); //cut string again at last space if there are space in the result above    	
	    	$result .= ' ...';
	    }
	    else {
	    	$result = $string;    	
	    }    
	    return $result;
	}

function catchuoi2($string = "", $num = 20){
	$a = $string;
	$a  = strip_tags($a, "");
	$a = trim($a);
	$a = rtrim($a);
	$a = str_replace("...", "", $a);
	$a = str_replace("-", "", $a);
	$a = str_replace("_", "", $a);
	$a = str_replace("|", "", $a);
	$a = str_replace("\"", "", $a);
	$a = str_replace("'", "", $a);
	$string = $a;
	    if(strlen($string) > $num)
	    {
	    	$result = substr($string,0,$num); //cut string with limited number
	    	$position = strrpos($result," "); //find position of last space
	    	if($position)
	    		$result = substr($result,0,$position); //cut string again at last space if there are space in the result above    	
	    	$result .= ' ...';
	    }
	    else {
	    	$result = $string;    	
	    }    
	    return $result;
	}

//Bo de dau trong chuoi	
function bodau($strAccent = "", $sepchar = " ") {
		
		$strfrom 	= " Á À Ả Ã Ạ Â Ấ Ầ Ẩ Ẫ Ậ Ă Ắ Ẳ Ẵ Ặ Đ É È Ẻ Ẽ Ẹ Ê Ế Ề Ể Ễ Ệ Í Ì Ỉ Ĩ Ị Ó Ò Ỏ Õ Ọ Ơ Ớ Ờ Ở Ỡ Ợ Ô Ố Ồ Ổ Õ Ộ Ú Ù Ủ Ũ Ụ Ư Ứ Ừ Ử Ũ Ụ Ý Ỳ Ỷ Ỹ Ỵ ";
		$strto		= " A A A A A A A A A A A A A A A A D E E E E E E E E E E E I I I I I O O O O O O O O O O O O O O O O O U U U U U U U U U U U Y Y Y Y Y ";
		
		$strfrom 	.= "á à ả ã ạ â ấ ầ ẩ ẫ ậ ă ắ ẳ ẵ ặ đ é è ẻ ẽ ẹ ê ế ề ể ễ ệ í ì ỉ ĩ ị ó ò ỏ õ ọ ơ ớ ờ ở ỡ ợ ô ố ồ ổ ỗ ộ ú ù ủ ũ ụ ư ứ ừ ử ữ ự ý ỳ ỷ ỹ ỵ";
		$strto		.= "a a a a a a a a a a a a a a a a d e e e e e e e e e e e i i i i i o o o o o o o o o o o o o o o o o u u u u u u u u u u u y y y y y";
				
		$fromarr = explode(" ", $strfrom);
		$toarr = explode(" ", $strto);
		
		$dicarr = array();
		for($i=1;$i<count($fromarr);$i++) {
			$dicarr[$fromarr[$i]] = $toarr[$i];
		}

		$strNoAccent = strtr($strAccent,$dicarr);
		
		$specialchar = ", . ? : ! < > & * ^ % $ # ; ' ( ) { } [ ] + / \"";
		$specialcharArr = explode(" ",$specialchar);
		
		$strNoAccent = str_replace($specialcharArr,"",$strNoAccent);
		
		if($sepchar) {
			$strNoAccent = str_replace(" ",$sepchar, $strNoAccent);
			$strNoAccent = str_replace($sepchar.$sepchar.$sepchar,$sepchar,$strNoAccent);
		}
			
		return $strNoAccent;
	}


function bodaudacbiet($strAccent = "", $sepchar = " ") {
		
		$strfrom 	= " Á À Ả Ã Ạ Â Ấ Ầ Ẩ Ẫ Ậ Ă Ắ Ẳ Ẵ Ặ Đ É È Ẻ Ẽ Ẹ Ê Ế Ề Ể Ễ Ệ Í Ì Ỉ Ĩ Ị Ó Ò Ỏ Õ Ọ Ơ Ớ Ờ Ở Ỡ Ợ Ô Ố Ồ Ổ Õ Ộ Ú Ù Ủ Ũ Ụ Ư Ứ Ừ Ử Ũ Ụ Ý Ỳ Ỷ Ỹ Ỵ ";
		$strto		= " A A A A A A A A A A A A A A A A D E E E E E E E E E E E I I I I I O O O O O O O O O O O O O O O O O U U U U U U U U U U U Y Y Y Y Y ";
		
		$strfrom 	.= "á à ả ã ạ â ấ ầ ẩ ẫ ậ ă ắ ẳ ẵ ặ đ é è ẻ ẽ ẹ ê ế ề ể ễ ệ í ì ỉ ĩ ị ó ò ỏ õ ọ ơ ớ ờ ở ỡ ợ ô ố ồ ổ ỗ ộ ú ù ủ ũ ụ ư ứ ừ ử ữ ự ý ỳ ỷ ỹ ỵ";
		$strto		.= "a a a a a a a a a a a a a a a a d e e e e e e e e e e e i i i i i o o o o o o o o o o o o o o o o o u u u u u u u u u u u y y y y y";
				
		$fromarr = explode(" ", $strfrom);
		$toarr = explode(" ", $strto);
		
		$dicarr = array();
		for($i=1;$i<count($fromarr);$i++) {
			$dicarr[$fromarr[$i]] = $toarr[$i];
		}

		$strNoAccent = strtr($strAccent,$dicarr);
		
		$specialchar = "< > * ^ % $ # ; ' { } [ ] + / \"";
		$specialcharArr = explode(" ",$specialchar);
		
		$strNoAccent = str_replace($specialcharArr,"",$strNoAccent);
		
		if($sepchar) {
			$strNoAccent = str_replace(" ",$sepchar, $strNoAccent);
			$strNoAccent = str_replace($sepchar.$sepchar.$sepchar,$sepchar,$strNoAccent);
		}
			
		return $strNoAccent;
	}


function bodau2($strAccent = "", $sepchar = " ") {
		
		$strfrom 	= " Á À Ả Ã Ạ Â Ấ Ầ Ẩ Ẫ Ậ Ă Ắ Ẳ Ẵ Ặ Đ É È Ẻ Ẽ Ẹ Ê Ế Ề Ể Ễ Ệ Í Ì Ỉ Ĩ Ị Ó Ò Ỏ Õ Ọ Ơ Ớ Ờ Ở Ỡ Ợ Ô Ố Ồ Ổ Õ Ộ Ú Ù Ủ Ũ Ụ Ư Ứ Ừ Ử Ũ Ụ Ý Ỳ Ỷ Ỹ Ỵ ";
		$strto		= " A A A A A A A A A A A A A A A A D E E E E E E E E E E E I I I I I O O O O O O O O O O O O O O O O O U U U U U U U U U U U Y Y Y Y Y ";
		
		$strfrom 	.= "á à ả ã ạ â ấ ầ ẩ ẫ ậ ă ắ ẳ ẵ ặ đ é è ẻ ẽ ẹ ê ế ề ể ễ ệ í ì ỉ ĩ ị ó ò ỏ õ ọ ơ ớ ờ ở ỡ ợ ô ố ồ ổ ỗ ộ ú ù ủ ũ ụ ư ứ ừ ử ữ ự ý ỳ ỷ ỹ ỵ";
		$strto		.= "a a a a a a a a a a a a a a a a d e e e e e e e e e e e i i i i i o o o o o o o o o o o o o o o o o u u u u u u u u u u u y y y y y";
				
		$fromarr = explode(" ", $strfrom);
		$toarr = explode(" ", $strto);
		
		$dicarr = array();
		for($i=1;$i<count($fromarr);$i++) {
			$dicarr[$fromarr[$i]] = $toarr[$i];
		}

		$strNoAccent = strtr($strAccent,$dicarr);
		
		$specialchar = " . ? : ! < > & * ^ % $ # @ ; ' ( ) { } [ ] + / \"";
		$specialcharArr = explode(" ",$specialchar);
		
		$strNoAccent = str_replace($specialcharArr,"",$strNoAccent);
		
		if($sepchar) {
			$strNoAccent = str_replace(" ",$sepchar, $strNoAccent);
			$strNoAccent = str_replace($sepchar.$sepchar.$sepchar,$sepchar,$strNoAccent);
		}
			
		return $strNoAccent;
	}
function chuyenuni($str) {

$convmap = array(
        0xe1,0xe1,0x0,0xe1,0xc1,0xc1,0x0,0xc1,0xe0,0xe0,0x0,0xe0,0xc0,0xc0,0x0,0xc0,0x1ea3,0x1ea3,0x0,0x1ea3,0x1ea2,0x1ea2,0x0,0x1ea2,0xe3,0xe3,0x0,0xe3,0xc3,0xc3,0x0,0xc3,0x1ea1,0x1ea1,0x0,0x1ea1,0x1ea0,0x1ea0,0x0,0x1ea0,
        0x103,0x103,0x0,0x103,0x102,0x102,0x0,0x102,0x1eaf,0x1eaf,0x0,0x1eaf,0x1eae,0x1eae,0x0,0x1eae,0x1eb1,0x1eb1,0x0,0x1eb1,0x1eb0,0x1eb0,0x0,0x1eb0,0x1eb3,0x1eb3,0x0,0x1eb3,0x1eb2,0x1eb2,0x0,0x1eb2,0x1eb5,0x1eb5,0x0,0x1eb5,
        0x1eb4,0x1eb4,0x0,0x1eb4,0x1eb7,0x1eb7,0x0,0x1eb7,0x1eb6,0x1eb6,0x0,0x1eb6,0xe2,0xe2,0x0,0xe2,0xc2,0xc2,0x0,0xc2,0x1ea5,0x1ea5,0x0,0x1ea5,0x1ea4,0x1ea4,0x0,0x1ea4,0x1ea7,0x1ea7,0x0,0x1ea7,0x1ea6,0x1ea6,0x0,0x1ea6,0x1ea9,
        0x1ea9,0x0,0x1ea9,0x1ea8,0x1ea8,0x0,0x1ea8,0x1eab,0x1eab,0x0,0x1eab,0x1eaa,0x1eaa,0x0,0x1eaa,0x1ead,0x1ead,0x0,0x1ead,0x1eac,0x1eac,0x0,0x1eac,0xe9,0xe9,0x0,0xe9,0xc9,0xc9,0x0,0xc9,0xe8,0xe8,0x0,0xe8,0xc8,0xc8,0x0,0xc8,
        0x1ebb,0x1ebb,0x0,0x1ebb,0x1eba,0x1eba,0x0,0x1eba,0x1ebd,0x1ebd,0x0,0x1ebd,0x1ebc,0x1ebc,0x0,0x1ebc,0x1eb9,0x1eb9,0x0,0x1eb9,0x1eb8,0x1eb8,0x0,0x1eb8,0xea,0xea,0x0,0xea,0xca,0xca,0x0,0xca,0x1ebf,0x1ebf,0x0,0x1ebf,0x1ebe,
        0x1ebe,0x0,0x1ebe,0x1ec1,0x1ec1,0x0,0x1ec1,0x1ec0,0x1ec0,0x0,0x1ec0,0x1ec3,0x1ec3,0x0,0x1ec3,0x1ec2,0x1ec2,0x0,0x1ec2,0x1ec5,0x1ec5,0x0,0x1ec5,0x1ec4,0x1ec4,0x0,0x1ec4,0x1ec7,0x1ec7,0x0,0x1ec7,0x1ec6,0x1ec6,0x0,0x1ec6,
        0xed,0xed,0x0,0xed,0xcd,0xcd,0x0,0xcd,0xec,0xec,0x0,0xec,0xcc,0xcc,0x0,0xcc,0x1ec9,0x1ec9,0x0,0x1ec9,0x1ec8,0x1ec8,0x0,0x1ec8,0x1ecb,0x1ecb,0x0,0x1ecb,0x1eca,0x1eca,0x0,0x1eca,0xf3,0xf3,0x0,0xf3,0xd3,0xd3,0x0,0xd3,0xf2,
        0xf2,0x0,0xf2,0xd2,0xd2,0x0,0xd2,0x1ecf,0x1ecf,0x0,0x1ecf,0x1ece,0x1ece,0x0,0x1ece,0xf5,0xf5,0x0,0xf5,0xd5,0xd5,0x0,0xd5,0x1ecd,0x1ecd,0x0,0x1ecd,0x1ecc,0x1ecc,0x0,0x1ecc,0x1a1,0x1a1,0x0,0x1a1,0x1a0,0x1a0,0x0,0x1a0,0x1edb,
        0x1edb,0x0,0x1edb,0x1eda,0x1eda,0x0,0x1eda,0x1edd,0x1edd,0x0,0x1edd,0x1edc,0x1edc,0x0,0x1edc,0x1edf,0x1edf,0x0,0x1edf,0x1ede,0x1ede,0x0,0x1ede,0x1ee1,0x1ee1,0x0,0x1ee1,0x1ee0,0x1ee0,0x0,0x1ee0,0x1ee3,0x1ee3,0x0,0x1ee3,
        0x1ee2,0x1ee2,0x0,0x1ee2,0xf4,0xf4,0x0,0xf4,0xd4,0xd4,0x0,0xd4,0x1ed1,0x1ed1,0x0,0x1ed1,0x1ed0,0x1ed0,0x0,0x1ed0,0x1ed3,0x1ed3,0x0,0x1ed3,0x1ed2,0x1ed2,0x0,0x1ed2,0x1ed5,0x1ed5,0x0,0x1ed5,0x1ed4,0x1ed4,0x0,0x1ed4,0x1ed7,
        0x1ed7,0x0,0x1ed7,0x1ed6,0x1ed6,0x0,0x1ed6,0x1ed9,0x1ed9,0x0,0x1ed9,0x1ed8,0x1ed8,0x0,0x1ed8,0xfa,0xfa,0x0,0xfa,0xda,0xda,0x0,0xda,0xf9,0xf9,0x0,0xf9,0xd9,0xd9,0x0,0xd9,0x1ee7,0x1ee7,0x0,0x1ee7,0x1ee6,0x1ee6,0x0,0x1ee6,
        0x169,0x169,0x0,0x169,0x168,0x168,0x0,0x168,0x1ee5,0x1ee5,0x0,0x1ee5,0x1ee4,0x1ee4,0x0,0x1ee4,0x1b0,0x1b0,0x0,0x1b0,0x1af,0x1af,0x0,0x1af,0x1ee9,0x1ee9,0x0,0x1ee9,0x1ee8,0x1ee8,0x0,0x1ee8,0x1eeb,0x1eeb,0x0,0x1eeb,0x1eea,
        0x1eea,0x0,0x1eea,0x1eed,0x1eed,0x0,0x1eed,0x1eec,0x1eec,0x0,0x1eec,0x1eef,0x1eef,0x0,0x1eef,0x1eee,0x1eee,0x0,0x1eee,0x1ef1,0x1ef1,0x0,0x1ef1,0x1ef0,0x1ef0,0x0,0x1ef0,0xfd,0xfd,0x0,0xfd,0xdd,0xdd,0x0,0xdd,0x1ef3,0x1ef3,
        0x0,0x1ef3,0x1ef2,0x1ef2,0x0,0x1ef2,0x1ef7,0x1ef7,0x0,0x1ef7,0x1ef6,0x1ef6,0x0,0x1ef6,0x1ef9,0x1ef9,0x0,0x1ef9,0x1ef8,0x1ef8,0x0,0x1ef8,0x1ef5,0x1ef5,0x0,0x1ef5,0x1ef4,0x1ef4,0x0,0x1ef4,0x111,0x111,0x0,0x111,0x110,0x110,0x0,0x110,
        0x128,0x128,0x0,0x128,0x129,0x129,0x0,0x129,
        );

  return mb_decode_numericentity($str, $convmap, "UTF-8");
        }
		
function DecimalToUni($str) {

$convmap = array(
        0xe1,0xe1,0x0,0xe1,0xc1,0xc1,0x0,0xc1,0xe0,0xe0,0x0,0xe0,0xc0,0xc0,0x0,0xc0,0x1ea3,0x1ea3,0x0,0x1ea3,0x1ea2,0x1ea2,0x0,0x1ea2,0xe3,0xe3,0x0,0xe3,0xc3,0xc3,0x0,0xc3,0x1ea1,0x1ea1,0x0,0x1ea1,0x1ea0,0x1ea0,0x0,0x1ea0,
        0x103,0x103,0x0,0x103,0x102,0x102,0x0,0x102,0x1eaf,0x1eaf,0x0,0x1eaf,0x1eae,0x1eae,0x0,0x1eae,0x1eb1,0x1eb1,0x0,0x1eb1,0x1eb0,0x1eb0,0x0,0x1eb0,0x1eb3,0x1eb3,0x0,0x1eb3,0x1eb2,0x1eb2,0x0,0x1eb2,0x1eb5,0x1eb5,0x0,0x1eb5,
        0x1eb4,0x1eb4,0x0,0x1eb4,0x1eb7,0x1eb7,0x0,0x1eb7,0x1eb6,0x1eb6,0x0,0x1eb6,0xe2,0xe2,0x0,0xe2,0xc2,0xc2,0x0,0xc2,0x1ea5,0x1ea5,0x0,0x1ea5,0x1ea4,0x1ea4,0x0,0x1ea4,0x1ea7,0x1ea7,0x0,0x1ea7,0x1ea6,0x1ea6,0x0,0x1ea6,0x1ea9,
        0x1ea9,0x0,0x1ea9,0x1ea8,0x1ea8,0x0,0x1ea8,0x1eab,0x1eab,0x0,0x1eab,0x1eaa,0x1eaa,0x0,0x1eaa,0x1ead,0x1ead,0x0,0x1ead,0x1eac,0x1eac,0x0,0x1eac,0xe9,0xe9,0x0,0xe9,0xc9,0xc9,0x0,0xc9,0xe8,0xe8,0x0,0xe8,0xc8,0xc8,0x0,0xc8,
        0x1ebb,0x1ebb,0x0,0x1ebb,0x1eba,0x1eba,0x0,0x1eba,0x1ebd,0x1ebd,0x0,0x1ebd,0x1ebc,0x1ebc,0x0,0x1ebc,0x1eb9,0x1eb9,0x0,0x1eb9,0x1eb8,0x1eb8,0x0,0x1eb8,0xea,0xea,0x0,0xea,0xca,0xca,0x0,0xca,0x1ebf,0x1ebf,0x0,0x1ebf,0x1ebe,
        0x1ebe,0x0,0x1ebe,0x1ec1,0x1ec1,0x0,0x1ec1,0x1ec0,0x1ec0,0x0,0x1ec0,0x1ec3,0x1ec3,0x0,0x1ec3,0x1ec2,0x1ec2,0x0,0x1ec2,0x1ec5,0x1ec5,0x0,0x1ec5,0x1ec4,0x1ec4,0x0,0x1ec4,0x1ec7,0x1ec7,0x0,0x1ec7,0x1ec6,0x1ec6,0x0,0x1ec6,
        0xed,0xed,0x0,0xed,0xcd,0xcd,0x0,0xcd,0xec,0xec,0x0,0xec,0xcc,0xcc,0x0,0xcc,0x1ec9,0x1ec9,0x0,0x1ec9,0x1ec8,0x1ec8,0x0,0x1ec8,0x1ecb,0x1ecb,0x0,0x1ecb,0x1eca,0x1eca,0x0,0x1eca,0xf3,0xf3,0x0,0xf3,0xd3,0xd3,0x0,0xd3,0xf2,
        0xf2,0x0,0xf2,0xd2,0xd2,0x0,0xd2,0x1ecf,0x1ecf,0x0,0x1ecf,0x1ece,0x1ece,0x0,0x1ece,0xf5,0xf5,0x0,0xf5,0xd5,0xd5,0x0,0xd5,0x1ecd,0x1ecd,0x0,0x1ecd,0x1ecc,0x1ecc,0x0,0x1ecc,0x1a1,0x1a1,0x0,0x1a1,0x1a0,0x1a0,0x0,0x1a0,0x1edb,
        0x1edb,0x0,0x1edb,0x1eda,0x1eda,0x0,0x1eda,0x1edd,0x1edd,0x0,0x1edd,0x1edc,0x1edc,0x0,0x1edc,0x1edf,0x1edf,0x0,0x1edf,0x1ede,0x1ede,0x0,0x1ede,0x1ee1,0x1ee1,0x0,0x1ee1,0x1ee0,0x1ee0,0x0,0x1ee0,0x1ee3,0x1ee3,0x0,0x1ee3,
        0x1ee2,0x1ee2,0x0,0x1ee2,0xf4,0xf4,0x0,0xf4,0xd4,0xd4,0x0,0xd4,0x1ed1,0x1ed1,0x0,0x1ed1,0x1ed0,0x1ed0,0x0,0x1ed0,0x1ed3,0x1ed3,0x0,0x1ed3,0x1ed2,0x1ed2,0x0,0x1ed2,0x1ed5,0x1ed5,0x0,0x1ed5,0x1ed4,0x1ed4,0x0,0x1ed4,0x1ed7,
        0x1ed7,0x0,0x1ed7,0x1ed6,0x1ed6,0x0,0x1ed6,0x1ed9,0x1ed9,0x0,0x1ed9,0x1ed8,0x1ed8,0x0,0x1ed8,0xfa,0xfa,0x0,0xfa,0xda,0xda,0x0,0xda,0xf9,0xf9,0x0,0xf9,0xd9,0xd9,0x0,0xd9,0x1ee7,0x1ee7,0x0,0x1ee7,0x1ee6,0x1ee6,0x0,0x1ee6,
        0x169,0x169,0x0,0x169,0x168,0x168,0x0,0x168,0x1ee5,0x1ee5,0x0,0x1ee5,0x1ee4,0x1ee4,0x0,0x1ee4,0x1b0,0x1b0,0x0,0x1b0,0x1af,0x1af,0x0,0x1af,0x1ee9,0x1ee9,0x0,0x1ee9,0x1ee8,0x1ee8,0x0,0x1ee8,0x1eeb,0x1eeb,0x0,0x1eeb,0x1eea,
        0x1eea,0x0,0x1eea,0x1eed,0x1eed,0x0,0x1eed,0x1eec,0x1eec,0x0,0x1eec,0x1eef,0x1eef,0x0,0x1eef,0x1eee,0x1eee,0x0,0x1eee,0x1ef1,0x1ef1,0x0,0x1ef1,0x1ef0,0x1ef0,0x0,0x1ef0,0xfd,0xfd,0x0,0xfd,0xdd,0xdd,0x0,0xdd,0x1ef3,0x1ef3,
        0x0,0x1ef3,0x1ef2,0x1ef2,0x0,0x1ef2,0x1ef7,0x1ef7,0x0,0x1ef7,0x1ef6,0x1ef6,0x0,0x1ef6,0x1ef9,0x1ef9,0x0,0x1ef9,0x1ef8,0x1ef8,0x0,0x1ef8,0x1ef5,0x1ef5,0x0,0x1ef5,0x1ef4,0x1ef4,0x0,0x1ef4,0x111,0x111,0x0,0x111,0x110,0x110,0x0,0x110,
        0x128,0x128,0x0,0x128,0x129,0x129,0x0,0x129,
        );

  return mb_decode_numericentity($str, $convmap, "UTF-8");
        }



	

//lay phan mo rong cua file, xu ly phan upload
 function layphanmorongcuafile($str)
{
         $i = strrpos($str,".");
         if (!$i) { return ""; }
         $l = strlen($str) - $i;
         $ext = substr($str,$i+1,$l);
         return $ext;
}

function getHeaders($url)
{
  $ch = curl_init($url);
  curl_setopt( $ch, CURLOPT_NOBODY, true );
  curl_setopt( $ch, CURLOPT_RETURNTRANSFER, false );
  curl_setopt( $ch, CURLOPT_HEADER, false );
  curl_setopt( $ch, CURLOPT_FOLLOWLOCATION, true );
  curl_setopt( $ch, CURLOPT_MAXREDIRS, 3 );
  curl_exec( $ch );
  $headers = curl_getinfo( $ch );
  curl_close( $ch );

  return $headers;
}

function downloadhinh($url, $path)
{
  # open file to write
  $fp = fopen ($path, 'w+');
  # start curl
  $ch = curl_init();
  curl_setopt( $ch, CURLOPT_URL, $url );
  # set return transfer to false
  curl_setopt( $ch, CURLOPT_RETURNTRANSFER, false );
  curl_setopt( $ch, CURLOPT_BINARYTRANSFER, true );
  curl_setopt( $ch, CURLOPT_SSL_VERIFYPEER, false );
  # increase timeout to download big file
  curl_setopt( $ch, CURLOPT_CONNECTTIMEOUT, 30000 );
  # write data to local file
  curl_setopt( $ch, CURLOPT_FILE, $fp );
  # execute curl
  curl_exec( $ch );
  # close curl
  curl_close( $ch );
  # close local file
  fclose( $fp );

  if (filesize($path) > 0)
  return true;
}



?>